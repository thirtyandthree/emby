define(["exports","./../modules/viewmanager/basesettingsview.js","./../modules/loading/loading.js","./../modules/common/globalize.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/formhelper.js","./../modules/maintabsmanager.js"],function(_exports,_basesettingsview,_loading,_globalize,_embyInput,_embyButton,_embyCheckbox,_embySelect,_formhelper,_maintabsmanager){function showAlert(options){Emby.importModule("./modules/common/dialogs/alert.js").then(function(alert){return alert(options)})}function onSubmitFail(response){_loading.default.hide(),response&&404===response.status?showAlert("The metadata path entered could not be found. Please ensure the path is valid and try again."):response&&500===response.status&&showAlert("The metadata path entered is not valid. Please ensure the path exists and that Emby server has write access to the folder.")}function onSubmit(e){_loading.default.show();var form=this;return ApiClient.getServerConfiguration().then(function(config){config.PreferredMetadataLanguage=form.querySelector(".selectLanguage").value,config.MetadataCountryCode=form.querySelector(".selectCountry").value,config.MetadataPath=form.querySelector(".txtMetadataPath").value,config.MetadataNetworkPath=form.querySelector(".txtMetadataNetworkPath").value,config.EnableExternalContentInSuggestions=form.querySelector(".chkExternalContentInSuggestions").checked,config.EnableSavedMetadataForPeople=form.querySelector(".chkPeopleMetadata").checked,config.EnableOriginalTrackTitles="original"===form.querySelector(".selectTrackTitleDisplay").value,ApiClient.updateServerConfiguration(config).then(_formhelper.default.handleConfigurationSavedResponse,onSubmitFail)}),function(form){ApiClient.getNamedConfiguration("metadata").then(function(config){config.UseFileCreationTimeForDateAdded="1"===form.querySelector(".selectDateAdded").value,ApiClient.updateNamedConfiguration("metadata",config)})}(form),e.preventDefault(),e.stopPropagation(),!1}function getTabs(){return[{href:"librarysetup/libraries",name:_globalize.default.translate("Libraries")},{href:"librarysetup/advanced",name:_globalize.default.translate("Advanced")}]}function View(view,params){_basesettingsview.default.apply(this,arguments),view.querySelector(".metadataPathDescription").innerHTML=_globalize.default.translate("LabelMetadataPathHelp",'<a href="scheduledtasks" is="emby-linkbutton" class="button-link">',"</a>"),view.querySelector(".btnSelectMetadataPath").addEventListener("click",function(){Emby.importModule("./modules/directorybrowser/directorybrowser.js").then(function(directoryBrowser){var picker=new directoryBrowser;picker.show({path:view.querySelector(".txtMetadataPath").value,networkSharePath:view.querySelector(".txtMetadataNetworkPath").value,callback:function(path,networkPath){path&&(view.querySelector(".txtMetadataPath").value=path,view.querySelector(".txtMetadataNetworkPath").value=networkPath),picker.close()},validateWriteable:!0,header:_globalize.default.translate("HeaderSelectMetadataPath"),instruction:_globalize.default.translate("HeaderSelectMetadataPathHelp"),enableNetworkSharePath:!0})})}),view.querySelector(".librarySettingsForm").addEventListener("submit",onSubmit)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(View.prototype,_basesettingsview.default.prototype),View.prototype.onResume=function(options){_basesettingsview.default.prototype.onResume.apply(this,arguments),_maintabsmanager.default.setTabs(this,1,getTabs)},View.prototype.loadSettingsInternal=function(){var select,view=this.view;return ApiClient.isMinServerVersion("4.8.0.54")?view.querySelector(".fldPeopleMetadata").classList.remove("hide"):view.querySelector(".fldPeopleMetadata").classList.add("hide"),Promise.all([ApiClient.getServerConfiguration(),(select=view.querySelector(".selectLanguage"),ApiClient.getCultures().then(function(languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.TwoLetterISOLanguageName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html})),function(select){return ApiClient.getCountries().then(function(allCountries){var html="";html+="<option value=''></option>";for(var i=0,length=allCountries.length;i<length;i++){var culture=allCountries[i];html+="<option value='"+culture.TwoLetterISORegionName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html})}(view.querySelector(".selectCountry")),ApiClient.getSystemInfo(),ApiClient.getNamedConfiguration("metadata")]).then(function(responses){var systemInfo=responses[3];!function(page,config,systemInfo){var metadataPath=(metadataPath=config.MetadataPath||"")||systemInfo.InternalMetadataPath;page.querySelector(".txtMetadataPath").value=metadataPath,page.querySelector(".txtMetadataNetworkPath").value=config.MetadataNetworkPath||"",page.querySelector(".chkExternalContentInSuggestions").checked=config.EnableExternalContentInSuggestions,page.querySelector(".chkPeopleMetadata").checked=config.EnableSavedMetadataForPeople,page.querySelector(".selectTrackTitleDisplay").value=config.EnableOriginalTrackTitles?"original":"",page.querySelector(".selectLanguage").value=config.PreferredMetadataLanguage||"",page.querySelector(".selectCountry").value=config.MetadataCountryCode||"",_loading.default.hide()}(view,responses[0],systemInfo),systemInfo=responses[4],view.querySelector(".selectDateAdded").value=systemInfo.UseFileCreationTimeForDateAdded?"1":"0"})};_exports.default=View});